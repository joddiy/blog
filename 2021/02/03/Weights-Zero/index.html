
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Jz Blog">
    <title>Weights Zero - Jz Blog</title>
    <meta name="author" content="Joddiy Zhang">
    
    
        <link rel="icon" href="https://joddiy.cc/assets/images/favicon.ico">
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Joddiy Zhang","sameAs":["https://github.com/joddiy","https://scholar.google.com/citations?user=KH-xv38AAAAJ&hl=en&oi=sra","https://www.linkedin.com/in/joddiyzhang/"],"image":"14108933.jpeg"},"articleBody":"EquationForward:\n1234e = embed(x)f = fc(e) # w * x + br = relu(f)l = mse(r, y)\n\nBackward:\n123456dr = dl * 2 * (r-y)df = 1 if f &gt;= 0 else 0 # 0.01 for leakyreludw = df * xdb = dfdx = df * wde # lookup from dx\n\nExperiment 1.Experiment setting\nembed weights as zero\nfc weights as uniform random by default\nfc bias as uniform random by default\nuse relu\n\nIntermediate valuesForward:\n1234e = embed(x) = 0f = fc(e) != 0 # w * e + br = relu(f) != 0l = mse(r, y) != 0\n\nBackward:\n123456dr = dl * 2 * (r-y) != 0df = 1 if f &gt; 0 else 0 != 0dw = df * e = 0db = df != 0dx = df * w != 0de # lookup from dx\n\nResultThe de of embed updates, db of fc updates, but dw of fc does not update.\nBut because this iteration update the de, so at the next iteration, the e will have value, so that dw = df * e will have value, and fc will update as normal.\nThe weights of embedding updates as normal. Because the bias in Pytorch are sampled from uniform distribution by default(as the following figure). Even though the w * e is zero, the f = w * e + b still has values, then df and dx = df * w has value, then the de can update.\n\nExperiment 2.Experiment setting\nembed weights as zero\nfc weights as uniform random by default\nfc no bias or bias as zero \nuse relu\n\nIntermediate valuesForward:\n1234e = embed(x) = 0f = fc(e) = 0 # w * er = relu(f) = 0l = mse(r, y) != 0\n\nBackward:\n12345dr = dl * 2 * (r-y) != 0df = 1 if f &gt; 0 else 0 = 0dw = df * e = 0dx = df * w = 0de # lookup from dx\nThe de and dw both do not update.\nBecause f = w * e = 0, then df is zero, dw and de are zero then.\nBut if the gradient of relu change to:\n11 if f &gt;= 0 else 0 = 0\nrather than:\n11 if f &gt; 0 else 0 = 0 # relu in pytorch\n\nThe df will be 1, and de can update then.\nExperiment 3.Experiment setting\nembed weights as zero\nfc weights as uniform random by default\nfc no bias or bias as zero \nuse leakyrelu\n\nIntermediate valuesForward:\n1234e = embed(x) = 0f = fc(e) = 0 # w * er = leaky_relu(f) = 0l = mse(r, y) != 0\n\nBackward:\n12345dr = dl * 2 * (r-y) != 0df = 1 if f &gt; 0 else 0.01 != 0dw = df * e = 0dx = df * w != 0de # lookup from dx\nThe de, but dw does not update.\nJust like mentioned above, the df will be 0.01, and de can update then.\nExperiment 4.Experiment setting\nembed weights as zero\nfc weights as zero\nfc no bias or bias as zero \nuse leakyrelu\n\nIntermediate valuesForward:\n1234e = embed(x) = 0f = fc(e) = 0 # w * er = leaky_relu(f) = 0l = mse(r, y) != 0\n\nBackward:\n12345dr = dl * 2 * (r-y) != 0df = 1 if f &gt; 0 else 0.01 != 0dw = df * e = 0dx = df * w = 0de # lookup from dx\nThe de and dw both do not update.\nBecause e and w are zero, so dw = df * w and dx = df * e are zero.\nExperiment 5.Experiment setting\nembed weights as ones\nfc weights as ones\nfc no bias or bias as zero \nuse leakyrelu\n\nIntermediate valuesForward:\n1234e = embed(x) = 1f = fc(e) = 1 # w * er = leaky_relu(f) = 1l = mse(r, y) != 0\n\nBackward:\n12345dr = dl * 2 * (r-y) != 0df = 1 if f &gt; 0 else 0.01 != 0dw = df * e != 0dx = df * w != 0de # lookup from dx\nAll cells in the de and dw update with the same direction.\nBecause e and w are same, and df cames from a single loss value.\nSo, in this case, no matter how many the weights there are, it can only be regarded as a single weight.\nSummaryFrom the  equation, we know:\n12345678910# forwarde = embed(x) = 0f = fc(e) = 0 # w * e...# backward...dw = df * edx = df * wde # lookup from dx\nThe weight of full-connection dw is affected by the output of embedding e, and the weight of embedding of de(or dx) is affected by the weights of full-connection w.\nBoth of them are affected by gradient from the next layers df.\nSo, even if we set the weights of embedding as zeros, since its gradient is calculated from the dx = df * w and de lookuped from dx, only if we keep df * w from the next layer have values, the de(from dx) will update as normal. So please be careful about the w and graident vanish issue of the df from the next layer.\nCodeDownload\n","dateCreated":"2021-02-03T22:06:19+08:00","dateModified":"2021-02-04T10:17:05+08:00","datePublished":"2021-02-03T22:06:19+08:00","description":"Doc for Weights Zero","headline":"Weights Zero","image":["https://img.icons8.com/ios/452/source-code.png","https://specials-images.forbesimg.com/imageserve/5f302109ffad89f9130e07db/960x0.jpg?cropX1=0&cropX2=4800&cropY1=243&cropY2=2943"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://joddiy.cc/2021/02/03/Weights-Zero/"},"publisher":{"@type":"Organization","name":"Joddiy Zhang","sameAs":["https://github.com/joddiy","https://scholar.google.com/citations?user=KH-xv38AAAAJ&hl=en&oi=sra","https://www.linkedin.com/in/joddiyzhang/"],"image":"14108933.jpeg","logo":{"@type":"ImageObject","url":"14108933.jpeg"}},"url":"https://joddiy.cc/2021/02/03/Weights-Zero/","keywords":"Deep Learning, Study, Pytorch","thumbnailUrl":"https://img.icons8.com/ios/452/source-code.png"}</script>
    <meta name="description" content="Doc for Weights Zero">
<meta property="og:type" content="blog">
<meta property="og:title" content="Weights Zero">
<meta property="og:url" content="https://joddiy.cc/2021/02/03/Weights-Zero/index.html">
<meta property="og:site_name" content="Jz Blog">
<meta property="og:description" content="Doc for Weights Zero">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://joddiy.cc/1.png">
<meta property="article:published_time" content="2021-02-03T14:06:19.000Z">
<meta property="article:modified_time" content="2021-02-04T02:17:05.000Z">
<meta property="article:author" content="Joddiy Zhang">
<meta property="article:tag" content="Deep Learning">
<meta property="article:tag" content="Study">
<meta property="article:tag" content="Pytorch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://joddiy.cc/1.png">
    
    
        
    
    
        <meta property="og:image" content="https://joddiy.cc/assets/images/14108933.jpeg"/>
    
    
        <meta property="og:image" content="https://img.icons8.com/ios/452/source-code.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://img.icons8.com/ios/452/source-code.png"/>
    
    
        <meta property="og:image" content="https://specials-images.forbesimg.com/imageserve/5f302109ffad89f9130e07db/960x0.jpg?cropX1=0&amp;cropX2=4800&amp;cropY1=243&amp;cropY2=2943"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://specials-images.forbesimg.com/imageserve/5f302109ffad89f9130e07db/960x0.jpg?cropX1=0&amp;cropX2=4800&amp;cropY1=243&amp;cropY2=2943"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-x8blglznjjnb9pnnwui5zw4h43ysufmsh1b0omicawm4vhqcutzqavokgpne.min.css">

    <!--STYLES END-->
    

    

    
        
            
<link rel="stylesheet" href="/assets/css/gitalk.css">

        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Jz Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/14108933.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/14108933.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Joddiy Zhang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/joddiy"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://scholar.google.com/citations?user=KH-xv38AAAAJ&hl=en&oi=sra"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google Scholar"
                        >
                        <i class="sidebar-button-icon fab fa-google" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Scholar</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/joddiyzhang/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-center
                    post-header-cover--partial"
             style="background-image:url('https://specials-images.forbesimg.com/imageserve/5f302109ffad89f9130e07db/960x0.jpg?cropX1=0&amp;cropX2=4800&amp;cropY1=243&amp;cropY2=2943');"
             data-behavior="4">
            
                <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            Weights Zero
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-02-03T22:06:19+08:00">
	
		    Feb 03, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study-Notes/">Study Notes</a>


    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h2 id="Equation"><a href="#Equation" class="headerlink" title="Equation"></a>Equation</h2><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x)</span><br><span class="line">f = fc(e) <span class="comment"># w * x + b</span></span><br><span class="line">r = relu(f)</span><br><span class="line">l = mse(r, y)</span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y)</span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> <span class="comment"># 0.01 for leakyrelu</span></span><br><span class="line">dw = df * x</span><br><span class="line">db = df</span><br><span class="line">dx = df * w</span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>

<h2 id="Experiment-1"><a href="#Experiment-1" class="headerlink" title="Experiment 1."></a>Experiment 1.</h2><h3 id="Experiment-setting"><a href="#Experiment-setting" class="headerlink" title="Experiment setting"></a>Experiment setting</h3><ul>
<li>embed weights as zero</li>
<li>fc weights as uniform random by default</li>
<li>fc bias as uniform random by default</li>
<li>use relu</li>
</ul>
<h3 id="Intermediate-values"><a href="#Intermediate-values" class="headerlink" title="Intermediate values"></a>Intermediate values</h3><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x) = <span class="number">0</span></span><br><span class="line">f = fc(e) != <span class="number">0</span> <span class="comment"># w * e + b</span></span><br><span class="line">r = relu(f) != <span class="number">0</span></span><br><span class="line">l = mse(r, y) != <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y) != <span class="number">0</span></span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> != <span class="number">0</span></span><br><span class="line">dw = df * e = <span class="number">0</span></span><br><span class="line">db = df != <span class="number">0</span></span><br><span class="line">dx = df * w != <span class="number">0</span></span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>

<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p><span style="color:red">The <strong><code>de</code> of <code>embed</code> updates</strong>, <code>db</code> of <code>fc</code> updates, but <code>dw</code> of <code>fc</code> does not update.</span></p>
<p>But because this iteration update the <code>de</code>, so at the next iteration, the <code>e</code> will have value, so that <code>dw = df * e</code> will have value, and <code>fc</code> will update as normal.</p>
<p><strong>The weights of embedding updates as normal. Because the bias in Pytorch are sampled from uniform distribution by default(as the following figure)</strong>. Even though the <code>w * e</code> is zero, the <code>f = w * e + b</code> still has values, then <code>df</code> and <code>dx = df * w</code> has value, then the <code>de</code> can update.</p>
<p><img src="/1.png"></p>
<h2 id="Experiment-2"><a href="#Experiment-2" class="headerlink" title="Experiment 2."></a>Experiment 2.</h2><h3 id="Experiment-setting-1"><a href="#Experiment-setting-1" class="headerlink" title="Experiment setting"></a>Experiment setting</h3><ul>
<li>embed weights as zero</li>
<li>fc weights as uniform random by default</li>
<li><span style="color:red">fc no bias or bias as zero </span></li>
<li>use relu</li>
</ul>
<h3 id="Intermediate-values-1"><a href="#Intermediate-values-1" class="headerlink" title="Intermediate values"></a>Intermediate values</h3><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x) = <span class="number">0</span></span><br><span class="line">f = fc(e) = <span class="number">0</span> <span class="comment"># w * e</span></span><br><span class="line">r = relu(f) = <span class="number">0</span></span><br><span class="line">l = mse(r, y) != <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y) != <span class="number">0</span></span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> = <span class="number">0</span></span><br><span class="line">dw = df * e = <span class="number">0</span></span><br><span class="line">dx = df * w = <span class="number">0</span></span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>
<p><span style="color:red"><strong>The <code>de</code> and <code>dw</code> both do not update</strong>.</span></p>
<p>Because <code>f = w * e = 0</code>, then <code>df</code> is zero, <code>dw</code> and <code>de</code> are zero then.</p>
<p>But if the gradient of relu change to:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">if</span> f &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>rather than:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> = <span class="number">0</span> <span class="comment"># relu in pytorch</span></span><br></pre></td></tr></table></figure>

<p>The <code>df</code> will be 1, and <code>de</code> can update then.</p>
<h2 id="Experiment-3"><a href="#Experiment-3" class="headerlink" title="Experiment 3."></a>Experiment 3.</h2><h3 id="Experiment-setting-2"><a href="#Experiment-setting-2" class="headerlink" title="Experiment setting"></a>Experiment setting</h3><ul>
<li>embed weights as zero</li>
<li>fc weights as uniform random by default</li>
<li><span style="color:red">fc no bias or bias as zero </span></li>
<li><span style="color:red">use leakyrelu</span></li>
</ul>
<h3 id="Intermediate-values-2"><a href="#Intermediate-values-2" class="headerlink" title="Intermediate values"></a>Intermediate values</h3><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x) = <span class="number">0</span></span><br><span class="line">f = fc(e) = <span class="number">0</span> <span class="comment"># w * e</span></span><br><span class="line">r = leaky_relu(f) = <span class="number">0</span></span><br><span class="line">l = mse(r, y) != <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y) != <span class="number">0</span></span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0.01</span> != <span class="number">0</span></span><br><span class="line">dw = df * e = <span class="number">0</span></span><br><span class="line">dx = df * w != <span class="number">0</span></span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>
<p><span style="color:red">The <strong><code>de</code>, but <code>dw</code> does not update.</strong></span></p>
<p>Just like mentioned above, the <code>df</code> will be 0.01, and <code>de</code> can update then.</p>
<h2 id="Experiment-4"><a href="#Experiment-4" class="headerlink" title="Experiment 4."></a>Experiment 4.</h2><h3 id="Experiment-setting-3"><a href="#Experiment-setting-3" class="headerlink" title="Experiment setting"></a>Experiment setting</h3><ul>
<li>embed weights as zero</li>
<li><span style="color:red">fc weights as zero</span></li>
<li><span style="color:red">fc no bias or bias as zero </span></li>
<li><span style="color:red">use leakyrelu</span></li>
</ul>
<h3 id="Intermediate-values-3"><a href="#Intermediate-values-3" class="headerlink" title="Intermediate values"></a>Intermediate values</h3><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x) = <span class="number">0</span></span><br><span class="line">f = fc(e) = <span class="number">0</span> <span class="comment"># w * e</span></span><br><span class="line">r = leaky_relu(f) = <span class="number">0</span></span><br><span class="line">l = mse(r, y) != <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y) != <span class="number">0</span></span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0.01</span> != <span class="number">0</span></span><br><span class="line">dw = df * e = <span class="number">0</span></span><br><span class="line">dx = df * w = <span class="number">0</span></span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>
<p><span style="color:red"><strong>The <code>de</code> and <code>dw</code> both do not update</strong>.</span></p>
<p>Because <code>e</code> and <code>w</code> are zero, so <code>dw = df * w</code> and <code>dx = df * e</code> are zero.</p>
<h2 id="Experiment-5"><a href="#Experiment-5" class="headerlink" title="Experiment 5."></a>Experiment 5.</h2><h3 id="Experiment-setting-4"><a href="#Experiment-setting-4" class="headerlink" title="Experiment setting"></a>Experiment setting</h3><ul>
<li><span style="color:red">embed weights as <strong>ones</strong></span></li>
<li><span style="color:red">fc weights as <strong>ones</strong></span></li>
<li><span style="color:red">fc no bias or bias as zero </span></li>
<li><span style="color:red">use leakyrelu</span></li>
</ul>
<h3 id="Intermediate-values-4"><a href="#Intermediate-values-4" class="headerlink" title="Intermediate values"></a>Intermediate values</h3><p>Forward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = embed(x) = <span class="number">1</span></span><br><span class="line">f = fc(e) = <span class="number">1</span> <span class="comment"># w * e</span></span><br><span class="line">r = leaky_relu(f) = <span class="number">1</span></span><br><span class="line">l = mse(r, y) != <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Backward:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dr = dl * <span class="number">2</span> * (r-y) != <span class="number">0</span></span><br><span class="line">df = <span class="number">1</span> <span class="keyword">if</span> f &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0.01</span> != <span class="number">0</span></span><br><span class="line">dw = df * e != <span class="number">0</span></span><br><span class="line">dx = df * w != <span class="number">0</span></span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>
<p><span style="color:red"><strong>All cells in the <code>de</code> and <code>dw</code> update with the same direction</strong>.</span></p>
<p>Because <code>e</code> and <code>w</code> are same, and <code>df</code> cames from a single loss value.</p>
<p>So, in this case, no matter how many the weights there are, it can only be regarded as a single weight.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>From the  equation, we know:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forward</span></span><br><span class="line">e = embed(x) = <span class="number">0</span></span><br><span class="line">f = fc(e) = <span class="number">0</span> <span class="comment"># w * e</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># backward</span></span><br><span class="line">...</span><br><span class="line">dw = df * e</span><br><span class="line">dx = df * w</span><br><span class="line">de <span class="comment"># lookup from dx</span></span><br></pre></td></tr></table></figure>
<p>The weight of full-connection <code>dw</code> is affected by the output of embedding <code>e</code>, and the weight of embedding of <code>de(or dx)</code> is affected by the weights of full-connection <code>w</code>.</p>
<p>Both of them are affected by gradient from the next layers <code>df</code>.</p>
<p>So, even if we set the weights of embedding as zeros, since its gradient is calculated from the <code>dx = df * w</code> and <code>de</code> lookuped from <code>dx</code>, only if we keep <code>df * w</code> from the next layer have values, the <code>de(from dx)</code> will update as normal. So please be careful about the <code>w</code> and graident vanish issue of the <code>df</code> from the next layer.</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1e9Hthq0eFvDyTyn2dL3Huwc8gS-_Kerh/view?usp=sharing">Download</a></p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Pytorch/" rel="tag">Pytorch</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Study/" rel="tag">Study</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/08/24/20220824-Shell/"
                    data-tooltip="20220824-Shell"
                    aria-label="PREVIOUS: 20220824-Shell"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/10/28/socc2020/"
                    data-tooltip="socc2020"
                    aria-label="NEXT: socc2020"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="gitalk"></div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 Joddiy Zhang. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/08/24/20220824-Shell/"
                    data-tooltip="20220824-Shell"
                    aria-label="PREVIOUS: 20220824-Shell"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/10/28/socc2020/"
                    data-tooltip="socc2020"
                    aria-label="NEXT: socc2020"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://joddiy.cc/2021/02/03/Weights-Zero/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://joddiy.cc/2021/02/03/Weights-Zero/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://joddiy.cc/2021/02/03/Weights-Zero/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://joddiy.cc/2021/02/03/Weights-Zero/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/14108933.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Joddiy Zhang</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Singapore
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-sqrh47zm5nkjgifq4rx38uvns4r2rarrrvwuhjxiztyrddruca5ukl7nw6br.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="/assets/js/gitalk.js"></script>

        <script type="text/javascript">
          (function() {
            new Gitalk({
              clientID: 'bee9685b2dc9739b6bd5',
              clientSecret: 'a0c683f383a94fae6d021ab932f37f7e56899410',
              repo: 'joddiy.github.io',
              owner: 'joddiy',
              admin: ['joddiy'],
              id: '2021/02/03/Weights-Zero/',
              ...{"language":"en","perPage":10,"distractionFreeMode":false,"enableHotKey":true,"pagerDirection":"first"}
            }).render('gitalk')
          })()
        </script>
    




    </body>
</html>
